{% extends 'layout/layout_home.html' %}
{% load static %}
{% block page_header %}
    Contact Us
{% endblock %}
{% block breadcrumb %}
    <a href="{% url 'home' %}">Home</a> /
    <span>Contact Us</span>
{% endblock %}
{% block body_block %}
    <div class="alice-bg section-padding-bottom">
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="contact-block">
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="contact-address">
                                    <h4>Contact Info</h4>
                                    <ul>
                                        <li><i data-feather="map-pin"></i><span id="address"></span></li>
                                        <li><i data-feather="mail"></i> <span id="support_email"></span> </li>
                                        <li><i data-feather="phone-call"></i><span id="phone"></span></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-7 offset-lg-1">
                                <div class="contact-form">
                                    <h4>Keep In Touch</h4>
                                    <form action="/api/send_email_to_admin_contact_us/" id="contactForm" class="ajax" method="POST" novalidate="novalidate" data-callback="contactUsCallback">
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input name="name" type="text" class="form-control" placeholder="Name" required>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input name="email" type="email" class="form-control" placeholder="Email" required>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input regex="\+?(88)?0?1[56789][0-9]{8}\b" name="phone" type="text" class="form-control" placeholder="Phone" data-msg-regex="Enter a valid Mobile Number" required>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <input name="subject" type="text" class="form-control" placeholder="Subject" required>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <textarea name="message" class="form-control" placeholder="Message" required></textarea>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                     <div class="g-recaptcha" data-sitekey="6LcOAKsZAAAAAP7MaEPv6A3T3mEC_UAsqTsu4epq" data-callback="verifyRecaptchaCallback" data-expired-callback="expiredRecaptchaCallback"></div>
                                                    <label id="error-captcha" class="my-error-class"></label>
                                                </div>
                                            </div>
                                        </div>
                                        <button class="button">Submit</button>
                                        <p class="input-success">Your message has been sent. Thanks for contact.</p>
                                        <p class="input-error">Something went wrong while sending. Please try leter.</p>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div id="map-area" class="contact-map">
                                    <div class="cp-map" id="location" data-lat="" data-lng="" data-zoom=""></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block extra_js %}
    <script>
        $(document).ready(function() {

            $("form.ajax:not(.ajax-linked)").on('submit', function(event) {
                event.preventDefault();
                var response = grecaptcha.getResponse();
                if(response.length == 0){
                    document.getElementById('error-captcha').innerHTML="You can't leave Captcha";
                }else{
                    if ($(this).valid()){
                    var url = $(this).prop('action');
                    var formId = $(this).attr("id");
                    var data = form2Json(formId);
                    // Image uploading code start here
                    var imagesrc = $(".image").attr('src');
                    if (imagesrc){
                        var imagesrcPart = imagesrc.split(":");
                        var jsonObj;
                        if (imagesrcPart[0] === "data"){
                            jsonObj = JSON.parse(data);
                            jsonObj.image = imagesrc;
                            data = JSON.stringify(jsonObj);
                        }else {
                            jsonObj = JSON.parse(data);
                            jsonObj.image = '';
                            data = JSON.stringify(jsonObj);
                        }
                    }

                    // Image uploading code end here

                    var method = $(this).attr('method');
                    var callback= $(this).data("callback");  // $(this).attr("data-callback");
                    send(url, method, data, callback);
                    grecaptcha.reset();
                    document.getElementById('error-captcha').innerHTML="";
                }
                }
                return false;
            });

            $('#contactForm').validate();
            settingsUrl = '/api/settings/';
            get(settingsUrl,loadSettings);
        });

        function verifyRecaptchaCallback() {
            recaptchachecked = true;
            if(recaptchachecked==true){
                document.getElementById('error-captcha').innerHTML="";
            }
        }

        function loadSettings(data) {
            if (data.length>0){
                data = data[0];
                $('#address').html(data.address);
                $('#phone').html(data.phone);
                $('#support_email').html(data.support_email);
                $('.cp-map').attr('data-lat',data.latitude);
                $('.cp-map').attr('data-lng',data.longitude);
                $('.cp-map').attr('data-zoom',data.zoom);
                initMap();
            }
        }

        function contactUsCallback(data){
            console.log('success');
            $("#contactForm input, #contactForm textarea").val('');
            showSuccess("Thanks for contacting us! We will get in touch with you shortly.")
        }
    </script>
{% endblock %}